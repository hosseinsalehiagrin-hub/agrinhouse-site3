<div class="hybrid-dock" data-agrinhouse-dock>
  <div class="dock-section agrinhouse-search-container">
    <div class="agrinhouse-search-box" id="agrinhouseSearchBox" role="search" aria-label="Search for premium fruits, greenhouse products, or export services">
      <input type="text" id="agrinhouseSearchInput" autocomplete="off" placeholder="Search for premium fruits..." aria-label="Search input for premium fruits, greenhouse products, or export services">
      <img src="/assets/icons/ttt.svg" class="agrinhouse-search-icon" id="agrinhouseSearchIcon" alt="Search icon" aria-hidden="true" loading="lazy" onerror="this.src='assets/icons/fallback.svg';this.classList.add('error');console.error('Failed to load search icon: '+this.src);">
      <div class="agrinhouse-search-results" id="agrinhouseAjaxSearchRes" role="listbox" aria-live="polite"></div>
    </div>
  </div>
  <ul class="text-nav" role="navigation">
    <li><a href="#company-profile" class="active" data-url="/company-profile">Company Profile</a></li>
    <li><a href="#products" data-url="/products/">Products</a></li>
    <li><a href="#partner-network" data-url="/partner-network/">Partner Network</a></li>
    <li><a href="#order-hub" onclick="toggleFruitPopup()">Order Hub</a></li>
  </ul>
  <div class="contact-icon-container">
    <a href="#contact-us" onclick="toggleEmailPopup()" aria-label="Contact Us">
      <img src="/assets/icons/ایمیل.svg" class="contact-icon" alt="Contact icon" aria-hidden="true" loading="lazy" onerror="this.src='/icons/fallback.svg';this.classList.add('error');console.error('Failed to load contact icon: '+this.src);">
    </a>
  </div>
  <div class="agrinhouse-email-popup" id="emailPopup" role="dialog" aria-label="Contact Form">
    <form id="emailForm" class="agrinhouse-email-form" method="POST" action="/send_email.php">
      <input type="hidden" name="formType" value="popup_contact">
      <input type="hidden" name="language" value="English">
      <h3>Contact AgrinHouse</h3>
      <div>
        <label for="contactName">Full Name</label>
        <input type="text" id="contactName" name="name" required aria-required="true">
        <div class="error-message" id="contactNameError">Please enter your full name</div>
      </div>
      <div>
        <label for="contactEmail">Email Address</label>
        <input type="email" id="contactEmail" name="email" required aria-required="true">
        <div class="error-message" id="contactEmailError">Please enter a valid email address</div>
      </div>
      <div>
        <label for="requestType">Inquiry Type</label>
        <select id="requestType" name="request_type" required aria-required="true">
          <option value="" disabled selected>Select inquiry type</option>
          <option value="Fruit Export">Fruit Export</option>
          <option value="Fruit Import">Fruit Import</option>
          <option value="General Inquiry">General Inquiry</option>
        </select>
        <div class="error-message" id="requestTypeError">Please select an inquiry type</div>
      </div>
      <div>
        <label for="subject">Subject</label>
        <input type="text" id="subject" name="subject" required aria-required="true">
        <div class="error-message" id="subjectError">Please enter a subject</div>
      </div>
      <div>
        <label for="contactMessage">Message</label>
        <textarea id="contactMessage" name="message" required aria-required="true"></textarea>
        <div class="error-message" id="contactMessageError">Please enter your message</div>
      </div>
      <button type="submit">Submit Inquiry</button>
      <div class="success-message" id="contactSuccessMessage">Inquiry sent successfully!</div>
    </form>
  </div>
  <div class="agrinhouse-fruit-popup" id="fruitPopup" role="dialog" aria-label="Fruit Purchase Request Form">
    <span class="agrinhouse-fruit-popup-close-btn" onclick="toggleFruitPopup()" aria-label="Close Form">&times;</span>
    <form id="fruitPurchaseForm" class="agrinhouse-fruit-popup-form" method="POST" action="/send_email.php">
      <input type="hidden" name="formType" value="popup_purchase">
      <input type="hidden" name="language" value="English">
      <h2>Fruit Purchase Request</h2>
      <div class="agrinhouse-fruit-popup-form-group">
        <label for="fruitName">Full Name</label>
        <input type="text" id="fruitName" name="name" required aria-required="true">
        <div class="error-message" id="fruitNameError">Please enter your full name</div>
      </div>
      <div class="agrinhouse-fruit-popup-form-group">
        <label for="fruitEmail">Email Address</label>
        <input type="email" id="fruitEmail" name="email" required aria-required="true">
        <div class="error-message" id="fruitEmailError">Please enter a valid email address</div>
      </div>
      <div class="agrinhouse-fruit-popup-form-group">
        <label for="fruitPhone">Phone Number</label>
        <input type="tel" id="fruitPhone" name="phone" placeholder="Code + Phone">
        <div class="error-message" id="fruitPhoneError"></div>
      </div>
      <div class="agrinhouse-fruit-popup-form-group">
        <label for="fruit">Fruit Type</label>
        <select id="fruit" name="fruit" required aria-required="true">
          <option value="" disabled selected>Select a fruit</option>
          <option value="apples">Apples</option>
          <option value="oranges">Oranges</option>
          <option value="bananas">Bananas</option>
          <option value="mangoes">Mangoes</option>
          <option value="other">Other</option>
        </select>
        <div class="error-message" id="fruitError">Please select a fruit type</div>
      </div>
      <div class="agrinhouse-fruit-popup-form-group">
        <label for="quantity">Quantity (in tons)</label>
        <input type="number" id="quantity" name="quantity" min="1" required aria-required="true">
        <div class="error-message" id="quantityError">Quantity must be at least 1 ton</div>
      </div>
      <div class="agrinhouse-fruit-popup-form-group">
        <label for="fruitMessage">Additional Details</label>
        <textarea id="fruitMessage" name="message" rows="4" placeholder="E.g., preferred delivery date, specific variety, etc."></textarea>
      </div>
      <button type="submit" class="agrinhouse-fruit-popup-submit-btn" id="fruitSubmitBtn">Submit Request</button>
      <div class="agrinhouse-fruit-popup-success" id="fruitSuccessMessage">Your request has been successfully submitted. Our team will contact you shortly to discuss further details.</div>
    </form>
  </div>
</div>
<style>
[data-agrinhouse-dock]{font-family:sans-serif;-webkit-font-smoothing:antialiased;-webkit-tap-highlight-color:transparent;}
[data-agrinhouse-dock]*{box-sizing:border-box;margin:0;padding:0;}
[data-agrinhouse-dock]{position:fixed;bottom:12px;left:50%;transform:translateX(-50%);display:flex;align-items:center;background:linear-gradient(135deg,rgba(30,41,59,.95),rgba(10,25,47,.9));backdrop-filter:blur(14px) saturate(180%);border:1px solid rgba(255,255,255,.1);border-radius:20px;padding:10px 12px;box-shadow:0 6px 20px rgba(0,0,0,.3);width:95%;max-width:1280px;min-width:1280px;height:64px;min-height:64px;opacity:0;visibility:hidden;transition:opacity .3s ease,visibility .3s ease,z-index .3s ease;}
[data-agrinhouse-dock].loaded{opacity:1;visibility:visible;z-index:2000;animation:slideUp .6s ease-out;}
@keyframes slideUp{0%{transform:translateX(-50%) translateY(20px);opacity:0;}to{transform:translateX(-50%) translateY(0);opacity:1;}}
[data-agrinhouse-dock] .dock-section{display:flex;align-items:center;gap:8px;}
[data-agrinhouse-dock] .text-nav{display:flex;gap:8px;margin:0 12px;padding:0;flex-grow:1;justify-content:center;list-style:none;}
[data-agrinhouse-dock] .text-nav li a{display:inline-block;padding:0 16px;height:50px;line-height:50px;background:0 0;border-radius:8px;text-decoration:none;color:rgba(255,255,255,.85);font-size:15px;font-weight:600;transition:all .2s ease;cursor:pointer;}
[data-agrinhouse-dock] .text-nav li a:hover{color:#fff;background:linear-gradient(145deg,rgba(0,120,212,.1),rgba(0,120,212,.05));box-shadow:inset 0 1px 3px rgba(0,0,0,.15);}
[data-agrinhouse-dock] .text-nav li a.active{color:#fff;background:linear-gradient(145deg,rgba(0,120,212,.25),rgba(0,120,212,.1));box-shadow:inset 0 2px 4px rgba(0,0,0,.15);}
[data-agrinhouse-dock] .agrinhouse-search-container{display:flex;align-items:center;}
[data-agrinhouse-dock] .agrinhouse-search-box{width:320px;height:50px;background:rgba(255,255,255,.08);backdrop-filter:blur(12px);border:1px solid transparent;border-radius:16px;display:flex;align-items:center;padding:0 14px;box-shadow:0 3px 10px rgba(0,0,0,.1);transition:all .3s ease;cursor:text;}
[data-agrinhouse-dock] .agrinhouse-search-box:hover{background:rgba(255,255,255,.12);box-shadow:0 5px 14px rgba(0,0,0,.12);}
[data-agrinhouse-dock] .agrinhouse-search-box:focus-within{width:400px;background:rgba(255,255,255,.15);border:1px solid rgba(0,120,212,.3);box-shadow:0 0 8px rgba(0,120,212,.25);}
[data-agrinhouse-dock] .agrinhouse-search-box input{border:none;outline:0;width:calc(100% - 28px);font-size:15px;font-weight:400;color:#f3f4f6;background:0 0;}
[data-agrinhouse-dock] .agrinhouse-search-box input::placeholder{color:rgba(255,255,255,.7);font-weight:400;}
[data-agrinhouse-dock] .agrinhouse-typed-text::after{content:'|';animation:agrinhouse-blink .7s infinite;}
@keyframes agrinhouse-blink{50%{opacity:0;}}
[data-agrinhouse-dock] .agrinhouse-search-icon{width:20px;height:20px;margin-left:8px;animation:agrinhouse-spin 1s linear infinite;display:none;}
@keyframes agrinhouse-spin{0%{transform:rotate(0);}to{transform:rotate(360deg);}}
[data-agrinhouse-dock] .agrinhouse-search-box.agrinhouse-searching .agrinhouse-search-icon{display:block;}
[data-agrinhouse-dock] .agrinhouse-search-results{position:absolute;bottom:100%;left:0;width:100%;background:linear-gradient(145deg,rgba(30,41,59,.95),rgba(10,25,47,.9));border:1px solid rgba(255,255,255,.15);border-radius:10px;max-height:260px;overflow-y:auto;scrollbar-width:none;display:none;box-shadow:0 -4px 12px rgba(0,0,0,.15);z-index:3000;}
[data-agrinhouse-dock] .agrinhouse-search-results::-webkit-scrollbar{display:none;}
[data-agrinhouse-dock] .agrinhouse-search-results.active{display:block;}
[data-agrinhouse-dock] .agrinhouse-search-result-item{padding:10px 14px;font-size:14px;font-weight:700;color:#f3f4f6;cursor:pointer;border-bottom:1px solid rgba(255,255,255,.1);transition:background .2s ease;}
[data-agrinhouse-dock] .agrinhouse-search-result-item:last-child{border-bottom:none;}
[data-agrinhouse-dock] .agrinhouse-search-result-item:hover{background:rgba(0,120,212,.2);box-shadow:inset 0 1px 3px rgba(0,0,0,.1);}
[data-agrinhouse-dock] .agrinhouse-search-result-item a{text-decoration:none;color:inherit;display:block;}
[data-agrinhouse-dock] .contact-icon-container{display:flex;align-items:center;justify-content:flex-end;padding-right:12px;}
[data-agrinhouse-dock] .contact-icon{display:block;width:36px;height:36px;cursor:pointer;}
[data-agrinhouse-dock] .contact-icon-container a{display:flex;align-items:center;justify-content:center;width:50px;height:50px;border-radius:8px;background:0 0;transition:background .2s ease;}
[data-agrinhouse-dock] .contact-icon-container a:hover{background:linear-gradient(145deg,rgba(0,120,212,.1),rgba(0,120,212,.05));box-shadow:inset 0 1px 3px rgba(0,0,0,.15);}
[data-agrinhouse-dock] .agrinhouse-email-popup,[data-agrinhouse-dock] .agrinhouse-fruit-popup{background:rgba(15,23,42,.95);backdrop-filter:blur(8px);border:1px solid rgba(255,255,255,.08);border-radius:10px;width:450px;max-height:700px;display:none;flex-direction:column;padding:20px;box-shadow:0 6px 24px rgba(0,0,0,.3);animation:fadeIn .3s ease-out;z-index:3100;position:fixed;bottom:84px;right:20px;}
@keyframes fadeIn{0%{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
[data-agrinhouse-dock] .agrinhouse-email-popup.show,[data-agrinhouse-dock] .agrinhouse-fruit-popup.show{display:flex!important;visibility:visible!important;opacity:1!important;}
[data-agrinhouse-dock] .agrinhouse-fruit-popup-close-btn{position:absolute;top:15px;right:15px;font-size:20px;color:#e2e8f0;cursor:pointer;font-weight:600;transition:color .3s ease;pointer-events:auto;}
[data-agrinhouse-dock] .agrinhouse-fruit-popup-close-btn:hover{color:#fff;}
[data-agrinhouse-dock] .agrinhouse-fruit-popup-form,[data-agrinhouse-dock] .agrinhouse-email-form{display:flex;flex-direction:column;gap:14px;width:100%;pointer-events:auto;}
[data-agrinhouse-dock] .agrinhouse-fruit-popup-form h2,[data-agrinhouse-dock] .agrinhouse-email-form h3{font-size:18px;font-weight:600;color:#e2e8f0;margin-bottom:10px;text-align:left;}
[data-agrinhouse-dock] .agrinhouse-fruit-popup-form-group label,[data-agrinhouse-dock] .agrinhouse-email-form label{font-size:14px;font-weight:500;color:#e2e8f0;margin-bottom:4px;}
[data-agrinhouse-dock] .agrinhouse-fruit-popup-form-group input,[data-agrinhouse-dock] .agrinhouse-fruit-popup-form-group select,[data-agrinhouse-dock] .agrinhouse-fruit-popup-form-group textarea,[data-agrinhouse-dock] .agrinhouse-email-form input,[data-agrinhouse-dock] .agrinhouse-email-form select,[data-agrinhouse-dock] .agrinhouse-email-form textarea{width:100%;padding:10px;border:1px solid rgba(255,255,255,.1);border-radius:6px;background:rgba(255,255,255,.03);color:#fff;font-size:14px;font-weight:500;transition:background .3s ease,border-color .3s ease;}
[data-agrinhouse-dock] .agrinhouse-fruit-popup-form-group select,[data-agrinhouse-dock] .agrinhouse-email-form select{appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%23e2e8f0' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 10px center;}
[data-agrinhouse-dock] .agrinhouse-fruit-popup-form-group select option,[data-agrinhouse-dock] .agrinhouse-email-form select option{background:#1e293b;color:#fff;}
[data-agrinhouse-dock] .agrinhouse-fruit-popup-form-group input:focus,[data-agrinhouse-dock] .agrinhouse-fruit-popup-form-group select:focus,[data-agrinhouse-dock] .agrinhouse-fruit-popup-form-group textarea:focus,[data-agrinhouse-dock] .agrinhouse-email-form input:focus,[data-agrinhouse-dock] .agrinhouse-email-form select:focus,[data-agrinhouse-dock] .agrinhouse-email-form textarea:focus{background:rgba(255,255,255,.06);border-color:rgba(255,255,255,.2);outline:0;}
[data-agrinhouse-dock] .agrinhouse-fruit-popup-form-group input:hover,[data-agrinhouse-dock] .agrinhouse-fruit-popup-form-group select:hover,[data-agrinhouse-dock] .agrinhouse-fruit-popup-form-group textarea:hover,[data-agrinhouse-dock] .agrinhouse-email-form input:hover,[data-agrinhouse-dock] .agrinhouse-email-form select:hover,[data-agrinhouse-dock] .agrinhouse-email-form textarea:hover{background:rgba(255,255,255,.05);}
[data-agrinhouse-dock] .agrinhouse-fruit-popup-form-group select option:disabled,[data-agrinhouse-dock] .agrinhouse-email-form select option:disabled{color:#9ca3af;}
[data-agrinhouse-dock] .agrinhouse-fruit-popup-form-group textarea,[data-agrinhouse-dock] .agrinhouse-email-form textarea{resize:vertical;min-height:80px;max-height:180px;}
[data-agrinhouse-dock] .agrinhouse-fruit-popup-form-group .error-message,[data-agrinhouse-dock] .agrinhouse-email-form .error-message{color:#ef4444;font-size:13px;margin-top:4px;display:none;}
[data-agrinhouse-dock] .agrinhouse-fruit-popup-form-group input.error,[data-agrinhouse-dock] .agrinhouse-fruit-popup-form-group select.error,[data-agrinhouse-dock] .agrinhouse-fruit-popup-form-group textarea.error,[data-agrinhouse-dock] .agrinhouse-email-form input.error,[data-agrinhouse-dock] .agrinhouse-email-form select.error,[data-agrinhouse-dock] .agrinhouse-email-form textarea.error{border-color:#ef4444;}
[data-agrinhouse-dock] .agrinhouse-fruit-popup-submit-btn,[data-agrinhouse-dock] .agrinhouse-email-form button{background:#1e293b;color:#fff;border:none;padding:10px;cursor:pointer;font-size:15px;font-weight:600;border-radius:6px;transition:background .3s ease;pointer-events:auto;}
[data-agrinhouse-dock] .agrinhouse-fruit-popup-submit-btn:hover,[data-agrinhouse-dock] .agrinhouse-email-form button:hover{background:#334155;}
[data-agrinhouse-dock] .agrinhouse-fruit-popup-submit-btn:disabled,[data-agrinhouse-dock] .agrinhouse-email-form button:disabled{opacity:.5;cursor:not-allowed;}
[data-agrinhouse-dock] .agrinhouse-fruit-popup-success,[data-agrinhouse-dock] .success-message{display:none;color:#10b981;font-size:14px;font-weight:500;text-align:center;margin-top:20px;padding:12px;background:rgba(16,185,129,.15);border-radius:6px;border:1px solid rgba(16,185,129,.3);opacity:1;}
[data-agrinhouse-dock] .agrinhouse-fruit-popup-success.show,[data-agrinhouse-dock] .success-message.show{display:block!important;visibility:visible!important;opacity:1!important;}
@media (max-width:767px){[data-agrinhouse-dock],[data-agrinhouse-dock] .agrinhouse-email-popup,[data-agrinhouse-dock] .agrinhouse-fruit-popup{display:none!important;visibility:hidden!important;opacity:0!important;height:0!important;width:0!important;overflow:hidden!important;position:absolute!important;left:-9999px!important;}}
@media (min-width:768px){[data-agrinhouse-dock]{bottom:12px;padding:10px 12px;width:95%;min-width:1280px;height:64px;min-height:64px;}[data-agrinhouse-dock] .text-nav li a{padding:0 16px;height:50px;line-height:50px;font-size:15px;border-radius:8px;}[data-agrinhouse-dock] .agrinhouse-search-box{width:320px;height:50px;padding:0 14px;border-radius:16px;}[data-agrinhouse-dock] .agrinhouse-search-box:focus-within{width:400px;}[data-agrinhouse-dock] .agrinhouse-search-box input{font-size:15px;}[data-agrinhouse-dock] .agrinhouse-search-results{max-height:260px;border-radius:10px;}[data-agrinhouse-dock] .agrinhouse-search-result-item{font-size:14px;padding:10px 14px;}[data-agrinhouse-dock] .agrinhouse-search-icon{width:20px;height:20px;margin-left:8px;}[data-agrinhouse-dock] .agrinhouse-email-popup,[data-agrinhouse-dock] .agrinhouse-fruit-popup{width:450px;max-height:700px;padding:20px;right:20px;bottom:84px;}[data-agrinhouse-dock] .agrinhouse-email-form input,[data-agrinhouse-dock] .agrinhouse-email-form select,[data-agrinhouse-dock] .agrinhouse-email-form textarea,[data-agrinhouse-dock] .agrinhouse-fruit-popup-form-group input,[data-agrinhouse-dock] .agrinhouse-fruit-popup-form-group select,[data-agrinhouse-dock] .agrinhouse-fruit-popup-form-group textarea{font-size:14px;padding:10px;}[data-agrinhouse-dock] .agrinhouse-email-form button,[data-agrinhouse-dock] .agrinhouse-fruit-popup-submit-btn{font-size:15px;padding:10px;}[data-agrinhouse-dock] .agrinhouse-fruit-popup-success,[data-agrinhouse-dock] .success-message{font-size:14px;margin-top:20px;padding:12px;}}
</style>
<script defer>
(()=>{if(window.innerWidth<=767){document.querySelector("[data-agrinhouse-dock]").style.display="none";return}const debug=m=>console.log(`[DEBUG] Dock: ${m}`),dock=document.querySelector("[data-agrinhouse-dock]");dock.style.width="95%";dock.style.maxWidth="1280px";dock.style.minWidth="1280px";dock.style.height="64px";dock.style.minHeight="64px";setTimeout(()=>{dock.classList.add("loaded");debug("Dock loaded with animation")},100);const getScrollbarWidth=()=>{const o=document.createElement("div");o.style.visibility="hidden";o.style.overflow="scroll";o.style.msOverflowStyle="scrollbar";document.body.appendChild(o);const i=document.createElement("div");o.appendChild(i);const w=o.offsetWidth-i.offsetWidth;o.parentNode.removeChild(o);return w};getScrollbarWidth();const navLinks=document.querySelectorAll(".text-nav a");navLinks.forEach(link=>{link.addEventListener("click",e=>{e.preventDefault();navLinks.forEach(n=>n.classList.remove("active"));link.classList.add("active");const url=link.getAttribute("data-url"),href=link.getAttribute("href");if(url&&["#company-profile","#products","#partner-network"].includes(href)){debug(`Nav link clicked: Opening window with URL: ${url}`);window.showWindow(url)}else if(href==="#order-hub"){debug("Order Hub clicked: Toggling fruit popup");toggleFruitPopup(e)}});link.addEventListener("keydown",e=>{if(e.key==="Enter"||e.key===" "){e.preventDefault();navLinks.forEach(n=>n.classList.remove("active"));link.classList.add("active");const url=link.getAttribute("data-url"),href=link.getAttribute("href");if(url&&["#company-profile","#products","#partner-network"].includes(href)){debug(`Nav link activated via keyboard: Opening window with URL: ${url}`);window.showWindow(url)}else if(href==="#order-hub"){debug("Order Hub activated via keyboard: Toggling fruit popup");toggleFruitPopup(e)}}})});const contactIconLink=document.querySelector(".contact-icon-container a");contactIconLink.addEventListener("click",e=>{e.preventDefault();e.stopPropagation();debug("Contact icon clicked: Toggling email popup");toggleEmailPopup(e)});contactIconLink.addEventListener("keydown",e=>{if(e.key==="Enter"||e.key===" "){e.preventDefault();e.stopPropagation();debug("Contact icon activated via keyboard: Toggling email popup");toggleEmailPopup(e)}});const placeholders=["Search for premium kiwi...","Find fresh red apples...","Explore yellow apples...","Discover juicy oranges...","Search for quality garlic...","Find greenhouse products...","Explore fruit export services...","Search for organic fruits..."],input=document.getElementById("agrinhouseSearchInput"),searchBox=document.getElementById("agrinhouseSearchBox"),searchResults=document.getElementById("agrinhouseAjaxSearchRes"),spinner=document.getElementById("agrinhouseSearchIcon");let currentIndex=0,charIndex=0,isDeleting=false,isTyping=true,currentText="",searchTimeout,animationTimeout=null;const cache=new Map,typePlaceholder=()=>{if(!isTyping)return;if(animationTimeout){clearTimeout(animationTimeout);animationTimeout=null}const p=placeholders[currentIndex];currentText=isDeleting?p.substring(0,charIndex-1):p.substring(0,charIndex+1);charIndex=isDeleting?charIndex-1:charIndex+1;input.setAttribute("placeholder",currentText);if(!isDeleting&&charIndex===p.length){isDeleting=true;animationTimeout=setTimeout(typePlaceholder,1500)}else if(isDeleting&&charIndex===0){isDeleting=false;currentIndex=(currentIndex+1)%placeholders.length;animationTimeout=setTimeout(typePlaceholder,150)}else{animationTimeout=setTimeout(typePlaceholder,isDeleting?100:200)}},displayResults=d=>{searchResults.innerHTML="";if(d.length>0){d.slice(0,10).forEach(i=>{const div=document.createElement("div");div.classList.add("agrinhouse-search-result-item");div.setAttribute("role","option");div.innerHTML=`<a href="${i.url}" title="${i.title}">${i.title} (${i.subtype})</a>`;div.addEventListener("click",()=>{input.value=i.title;searchResults.classList.remove("active");searchBox.classList.remove("agrinhouse-searching");spinner.style.display="none";window.location.href=i.url});searchResults.appendChild(div)});searchResults.classList.add("active")}else{const div=document.createElement("div");div.classList.add("agrinhouse-search-result-item");div.setAttribute("role","option");div.textContent="No results found. Try searching for kiwi, apples, oranges, garlic, or greenhouse products.";searchResults.appendChild(div);searchResults.classList.add("active")}searchBox.classList.remove("agrinhouse-searching");spinner.style.display="none"},debounceSearch=()=>{clearTimeout(searchTimeout);searchTimeout=setTimeout(()=>{const q=input.value.trim().toLowerCase();if(q.length<2){searchResults.classList.remove("active");searchBox.classList.remove("agrinhouse-searching");spinner.style.display="none";if(!input.value.trim()){isTyping=true;charIndex=0;isDeleting=false;currentText="";currentIndex=0;typePlaceholder()}return}searchBox.classList.add("agrinhouse-searching");spinner.style.display="block";let sq=encodeURIComponent(q);const rt=["kiwi","apple","orange","garlic","greenhouse","fruit","export","organic"];if(rt.some(t=>q.includes(t))){sq+="+agrinhouse+premium+export"}if(cache.has(sq)){displayResults(cache.get(sq));return}fetch(`https://agrinhouse.com/wp-json/wp/v2/search?search=${sq}&per_page=10`,{signal:AbortSignal.timeout(5000)}).then(r=>{if(!r.ok)throw new Error("Search request failed");return r.json()}).then(d=>{cache.set(sq,d);displayResults(d)}).catch(e=>{console.error("Search error:",e);searchResults.innerHTML='<div class="agrinhouse-search-result-item" role="option">Error fetching results. Please try again.</div>';searchResults.classList.add("active");searchBox.classList.remove("agrinhouse-searching");spinner.style.display="none"})},300)};input.addEventListener("input",e=>{e.stopPropagation();debounceSearch()});input.addEventListener("click",e=>{e.stopPropagation();if(input.value.trim().length>=2)searchResults.classList.add("active")});searchBox.addEventListener("click",e=>{e.stopPropagation();input.focus()});input.addEventListener("focus",()=>{if(!input.value){if(animationTimeout){clearTimeout(animationTimeout);animationTimeout=null}input.setAttribute("placeholder","");isTyping=false}});input.addEventListener("blur",()=>{if(!input.value.trim()){searchBox.classList.remove("agrinhouse-searching");spinner.style.display="none";isTyping=true;charIndex=0;isDeleting=false;currentText="";currentIndex=0;if(animationTimeout){clearTimeout(animationTimeout);animationTimeout=null}typePlaceholder()}});document.addEventListener("click",e=>{if(!searchBox.contains(e.target)){searchResults.classList.remove("active");searchBox.classList.remove("agrinhouse-searching");spinner.style.display="none";if(!input.value.trim()){isTyping=true;charIndex=0;isDeleting=false;currentText="";currentIndex=0;if(animationTimeout){clearTimeout(animationTimeout);animationTimeout=null}typePlaceholder()}}});typePlaceholder();const toggleEmailPopup=e=>{try{if(window.innerWidth<=767){debug("Mobile device detected, skipping popup");return}e.stopPropagation();const ep=document.getElementById("emailPopup"),fp=document.getElementById("fruitPopup");if(!ep){console.error("Email popup element not found");return}debug("Toggling email popup");ep.classList.toggle("show");if(ep.classList.contains("show")){fp.classList.remove("show");const cn=document.getElementById("contactName");if(cn)cn.focus();else console.error("Contact name input not found");resetEmailForm()}}catch(e){console.error("Error in toggleEmailPopup:",e)}},resetEmailForm=()=>{try{if(window.innerWidth<=767)return;debug("Resetting email form");const f=document.getElementById("emailForm"),sm=document.getElementById("contactSuccessMessage");if(!f||!sm){console.error("Email form or success message element not found");return}f.reset();f.style.display="flex";document.querySelectorAll(".agrinhouse-email-form .error-message").forEach(e=>e.style.display="none");document.querySelectorAll(".agrinhouse-email-form input,.agrinhouse-email-form select,.agrinhouse-email-form textarea").forEach(i=>i.classList.remove("error"));sm.style.display="none";sm.classList.remove("show")}catch(e){console.error("Error in resetEmailForm:",e)}};document.getElementById("emailForm").addEventListener("submit",async e=>{e.preventDefault();e.stopPropagation();try{debug("Submitting email form");const f=e.target,sb=f.querySelector('button[type="submit"]'),sm=document.getElementById("contactSuccessMessage");if(!sm){console.error("Contact success message element not found");return}const n=document.getElementById("contactName").value.trim(),em=document.getElementById("contactEmail").value.trim(),rt=document.getElementById("requestType").value,s=document.getElementById("subject").value.trim(),m=document.getElementById("contactMessage").value.trim();let v=true;document.querySelectorAll(".agrinhouse-email-form .error-message").forEach(e=>e.style.display="none");document.querySelectorAll(".agrinhouse-email-form input,.agrinhouse-email-form select,.agrinhouse-email-form textarea").forEach(i=>i.classList.remove("error"));if(!n){document.getElementById("contactNameError").style.display="block";document.getElementById("contactName").classList.add("error");v=false}if(!em||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(em)){document.getElementById("contactEmailError").style.display="block";document.getElementById("contactEmail").classList.add("error");v=false}if(!rt){document.getElementById("requestTypeError").style.display="block";document.getElementById("requestType").classList.add("error");v=false}if(!s){document.getElementById("subjectError").style.display="block";document.getElementById("subject").classList.add("error");v=false}if(!m){document.getElementById("contactMessageError").style.display="block";document.getElementById("contactMessage").classList.add("error");v=false}if(v){sb.disabled=true;debug("Form is valid, sending request");try{const fd=new FormData(f),r=await fetch("/send_email.php",{method:"POST",body:fd}),res=await r.json();debug(`Server response: ${JSON.stringify(res)}`);if(res.success){debug("Form submission successful, showing success message");f.style.display="none";sm.style.display="block";sm.classList.add("show");setTimeout(()=>{debug("Hiding success message and closing popup");sm.style.display="none";sm.classList.remove("show");document.getElementById("emailPopup").classList.remove("show");sb.disabled=false;f.style.display="flex"},2500)}else{console.error("Server error:",res.error);alert("Error sending inquiry: "+res.error);sb.disabled=false;f.style.display="flex"}}catch(e){console.error("Fetch error:",e);alert("Error sending inquiry. Please try again later.");sb.disabled=false;f.style.display="flex"}}else{debug("Form validation failed")}}catch(e){console.error("Error in email form submission:",e)}});const toggleFruitPopup=e=>{try{if(window.innerWidth<=767){debug("Mobile device detected, skipping popup");return}e.stopPropagation();const fp=document.getElementById("fruitPopup"),ep=document.getElementById("emailPopup");if(!fp){console.error("Fruit popup element not found");return}debug("Toggling fruit popup");fp.classList.toggle("show");if(fp.classList.contains("show")){ep.classList.remove("show");const fn=document.getElementById("fruitName");if(fn)fn.focus();else console.error("Fruit name input not found");resetFruitForm()}}catch(e){console.error("Error in toggleFruitPopup:",e)}},resetFruitForm=()=>{try{if(window.innerWidth<=767)return;debug("Resetting fruit form");const f=document.getElementById("fruitPurchaseForm"),sm=document.getElementById("fruitSuccessMessage");if(!f||!sm){console.error("Fruit form or success message element not found");return}f.reset();f.style.display="flex";document.querySelectorAll(".agrinhouse-fruit-popup-form .error-message").forEach(e=>e.style.display="none");document.querySelectorAll(".agrinhouse-fruit-popup-form input,.agrinhouse-fruit-popup-form select,.agrinhouse-fruit-popup-form textarea").forEach(i=>i.classList.remove("error"));document.getElementById("fruitSubmitBtn").disabled=false;sm.style.display="none";sm.classList.remove("show")}catch(e){console.error("Error in resetFruitForm:",e)}};document.getElementById("fruitPhone").addEventListener("input",e=>{e.stopPropagation();let v=document.getElementById("fruitPhone").value.trim();document.getElementById("fruitPhone").value=v});document.addEventListener("click",e=>{try{const ep=document.getElementById("emailPopup"),fp=document.getElementById("fruitPopup"),ohl=document.querySelector('a[href="#order-hub"]'),cul=document.querySelector('a[href="#contact-us"]');if(ep&&!ep.contains(e.target)&&cul&&!cul.contains(e.target)&&ep.classList.contains("show")){debug("Closing email popup");ep.classList.remove("show")}if(fp&&!fp.contains(e.target)&&ohl&&!ohl.contains(e.target)&&fp.classList.contains("show")){debug("Closing fruit popup");fp.classList.remove("show")}}catch(e){console.error("Error in click handler:",e)}});document.addEventListener("keydown",e=>{try{if(e.key==="Escape"){const ep=document.getElementById("emailPopup"),fp=document.getElementById("fruitPopup");if(ep&&ep.classList.contains("show")){debug("Closing email popup via Escape");ep.classList.remove("show")}if(fp&&fp.classList.contains("show")){debug("Closing fruit popup via Escape");fp.classList.remove("show")}}}catch(e){console.error("Error in keydown handler:",e)}});document.getElementById("fruitPurchaseForm").addEventListener("submit",async e=>{e.preventDefault();e.stopPropagation();try{debug("Submitting fruit purchase form");const f=e.target,sb=f.querySelector("#fruitSubmitBtn"),sm=document.getElementById("fruitSuccessMessage");if(!sm){console.error("Fruit success message element not found");return}const n=f.querySelector("#fruitName").value.trim(),em=f.querySelector("#fruitEmail").value.trim(),p=f.querySelector("#fruitPhone").value.trim(),fr=f.querySelector("#fruit").value,q=f.querySelector("#quantity").value,m=f.querySelector("#fruitMessage").value.trim();let v=true;const err={};if(!n){err.fruitName="Please enter your full name";v=false}if(!em||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(em)){err.fruitEmail="Please enter a valid email address";v=false}if(!fr){err.fruit="Please select a fruit type";v=false}if(!q||q<1){err.quantity="Quantity must be at least 1 ton";v=false}["fruitName","fruitEmail","fruit","quantity"].forEach(field=>{const i=f.querySelector(`#${field}`),ed=f.querySelector(`#${field}Error`);ed.textContent=err[field]||"";ed.style.display=err[field]?"block":"none";i.classList.toggle("error",!!err[field])});if(v){sb.disabled=true;debug("Form is valid, sending request");try{const fd=new FormData;fd.append("name",n);fd.append("email",em);fd.append("phone",p||"N/A");fd.append("fruit",fr);fd.append("quantity",q);fd.append("message",m||"N/A");fd.append("formType","popup_purchase");fd.append("language","English");const r=await fetch("/send_email.php",{method:"POST",body:fd}),d=await r.json();debug(`Server response: ${JSON.stringify(d)}`);if(d.success){debug("Form submission successful, showing success message");f.style.display="none";sm.style.display="block";sm.classList.add("show");setTimeout(()=>{debug("Hiding success message and closing popup");sm.style.display="none";sm.classList.remove("show");document.getElementById("fruitPopup").classList.remove("show");sb.disabled=false;f.style.display="flex"},2500)}else{console.error("Server error:",d.error);alert("Failed to send purchase request: "+d.error);sb.disabled=false;f.style.display="flex"}}catch(e){console.error("Fetch error:",e);alert("Failed to send purchase request. Please try again.");sb.disabled=false;f.style.display="flex"}}else{debug("Form validation failed")}}catch(e){console.error("Error in fruit form submission:",e)}});document.addEventListener("DOMContentLoaded",()=>{try{debug("DOM loaded, initializing forms");if(window.innerWidth<=767){document.querySelector("[data-agrinhouse-dock]").style.display="none";document.querySelector(".agrinhouse-email-popup").style.display="none";document.querySelector(".agrinhouse-fruit-popup").style.display="none"}else{if(document.body.classList.contains("elementor-editor-active")){document.body.style.paddingRight="0";debug("Elementor editor active, adjusted padding")}resetEmailForm();resetFruitForm()}}catch(e){console.error("Error in DOMContentLoaded:",e)}})})();
</script>
