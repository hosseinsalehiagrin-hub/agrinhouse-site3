# روشن کردن مدول بازنویسی
RewriteEngine On
RewriteBase /

# -------------------------------
# ریدایرکت www به non-www
# -------------------------------
RewriteCond %{HTTP_HOST} ^www\.(.+)$ [NC]
RewriteRule ^ https://%1%{REQUEST_URI} [R=301,L]

# -------------------------------
# اضافه کردن هدرهای CORS برای فایل‌های components
# -------------------------------
<IfModule mod_headers.c>
    <FilesMatch "\.(html|js|css)$">
        Header set Access-Control-Allow-Origin "*"
        Header set Access-Control-Allow-Methods "GET"
    </FilesMatch>
</IfModule>

# -------------------------------
# ریدایرکت index.html به /
# -------------------------------
RewriteCond %{THE_REQUEST} /index\.html [NC]
RewriteRule ^index\.html$ / [R=301,L]

# -------------------------------
# ریدایرکت home.html به /home
# -------------------------------
RewriteCond %{THE_REQUEST} /home\.html [NC]
RewriteRule ^home\.html$ /home [R=301,L]

# -------------------------------
# load home.html وقتی کاربر /home زد
# -------------------------------
RewriteCond %{REQUEST_URI} ^/home$ [NC]
RewriteRule ^home$ home.html [L]

# -------------------------------
# حذف پسوند .html برای همه صفحات واقعی
# -------------------------------
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}\.html -f
RewriteCond %{HTTP_USER_AGENT} !(Googlebot|bingbot|Baiduspider|Slurp|DuckDuckBot) [NC]
RewriteRule ^(.*)$ $1.html [L]

# -------------------------------
# ریدایرکت صفحات فرعی به home با پارامتر page (فقط برای کاربران)
# -------------------------------
RewriteCond %{REQUEST_URI} ^/([a-zA-Z0-9-]+)$ [NC]
RewriteCond %{REQUEST_FILENAME} -d
RewriteCond %{REQUEST_URI} !^/(home|index)$ [NC]
RewriteCond %{HTTP_USER_AGENT} !(Googlebot|bingbot|Baiduspider|Slurp|DuckDuckBot) [NC]
RewriteRule ^([a-zA-Z0-9-]+)$ /home?page=$1 [R=302,L,NE]

# -------------------------------
# دسترسی به index.html برای همه
# -------------------------------
<Files "index.html">
    Require all granted
</Files>